<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title># d3-timer</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="../../../markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="d3-timer">d3-timer</h1>
<p>This module provides an efficient queue capable of managing thousands
of concurrent animations, while guaranteeing consistent, synchronized
timing with concurrent or staged animations. Internally, it uses <a
href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">requestAnimationFrame</a>
for fluid animation (if available), switching to <a
href="https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout">setTimeout</a>
for delays longer than 24ms.</p>
<h2 id="installing">Installing</h2>
<p>If you use NPM, <code>npm install d3-timer</code>. Otherwise,
download the <a
href="https://github.com/d3/d3-timer/releases/latest">latest
release</a>. You can also load directly from <a
href="https://d3js.org">d3js.org</a>, either as a <a
href="https://d3js.org/d3-timer.v1.min.js">standalone library</a> or as
part of <a href="https://github.com/d3/d3">D3 4.0</a>. AMD, CommonJS,
and vanilla environments are supported. In vanilla, a <code>d3</code>
global is exported:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script</span> <span class="er">src</span><span class="ot">=</span><span class="st">&quot;https://d3js.org/d3-timer.v1.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> timer <span class="op">=</span> d3<span class="op">.</span><span class="fu">timer</span>(callback)<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/script&gt;</span></span></code></pre></div>
<p><a href="https://tonicdev.com/npm/d3-timer">Try d3-timer in your
browser.</a></p>
<h2 id="api-reference">API Reference</h2>
<p><a name="now" href="#now">#</a> d3.<b>now</b>() <a
href="https://github.com/d3/d3-timer/blob/master/src/timer.js#L15"
title="Source">&lt;&gt;</a></p>
<p>Returns the current time as defined by <a
href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/now">performance.now</a>
if available, and <a
href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Date/now">Date.now</a>
if not. The current time is updated at the start of a frame; it is thus
consistent during the frame, and any timers scheduled during the same
frame will be synchronized. If this method is called outside of a frame,
such as in response to a user event, the current time is calculated and
then fixed until the next frame, again ensuring consistent timing during
event handling.</p>
<p><a name="timer" href="#timer">#</a> d3.<b>timer</b>(<i>callback</i>[,
<i>delay</i>[, <i>time</i>]]) <a
href="https://github.com/d3/d3-timer/blob/master/src/timer.js#L52"
title="Source">&lt;&gt;</a></p>
<p>Schedules a new timer, invoking the specified <em>callback</em>
repeatedly until the timer is <a href="#timer_stop">stopped</a>. An
optional numeric <em>delay</em> in milliseconds may be specified to
invoke the given <em>callback</em> after a delay; if <em>delay</em> is
not specified, it defaults to zero. The delay is relative to the
specified <em>time</em> in milliseconds; if <em>time</em> is not
specified, it defaults to <a href="#now">now</a>.</p>
<p>The <em>callback</em> is passed the (apparent) <em>elapsed</em> time
since the timer became active. For example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> t <span class="op">=</span> d3<span class="op">.</span><span class="fu">timer</span>(<span class="kw">function</span>(elapsed) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(elapsed)<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (elapsed <span class="op">&gt;</span> <span class="dv">200</span>) t<span class="op">.</span><span class="fu">stop</span>()<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> <span class="dv">150</span>)<span class="op">;</span></span></code></pre></div>
<p>This produces roughly the following console output:</p>
<pre><code>3
25
48
65
85
106
125
146
167
189
209</code></pre>
<p>(The exact values may vary depending on your JavaScript runtime and
what else your computer is doing.) Note that the first <em>elapsed</em>
time is 3ms: this is the elapsed time since the timer started, not since
the timer was scheduled. Here the timer started 150ms after it was
scheduled due to the specified delay. The apparent <em>elapsed</em> time
may be less than the true <em>elapsed</em> time if the page is
backgrounded and <a
href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">requestAnimationFrame</a>
is paused; in the background, apparent time is frozen.</p>
<p>If <a href="#timer">timer</a> is called within the callback of
another timer, the new timer callback (if eligible as determined by the
specified <em>delay</em> and <em>time</em>) will be invoked immediately
at the end of the current frame, rather than waiting until the next
frame. Within a frame, timer callbacks are guaranteed to be invoked in
the order they were scheduled, regardless of their start time.</p>
<p><a name="timer_restart" href="#timer_restart">#</a>
<i>timer</i>.<b>restart</b>(<i>callback</i>[, <i>delay</i>[,
<i>time</i>]]) <a
href="https://github.com/d3/d3-timer/blob/master/src/timer.js#L31"
title="Source">&lt;&gt;</a></p>
<p>Restart a timer with the specified <em>callback</em> and optional
<em>delay</em> and <em>time</em>. This is equivalent to stopping this
timer and creating a new timer with the specified arguments, although
this timer retains the original invocation priority.</p>
<p><a name="timer_stop" href="#timer_stop">#</a>
<i>timer</i>.<b>stop</b>() <a
href="https://github.com/d3/d3-timer/blob/master/src/timer.js#L43"
title="Source">&lt;&gt;</a></p>
<p>Stops this timer, preventing subsequent callbacks. This method has no
effect if the timer has already stopped.</p>
<p><a name="timerFlush" href="#timerFlush">#</a> d3.<b>timerFlush</b>()
<a href="https://github.com/d3/d3-timer/blob/master/src/timer.js#L58"
title="Source">&lt;&gt;</a></p>
<p>Immediately invoke any eligible timer callbacks. Note that zero-delay
timers are normally first executed after one frame (~17ms). This can
cause a brief flicker because the browser renders the page twice: once
at the end of the first event loop, then again immediately on the first
timer callback. By flushing the timer queue at the end of the first
event loop, you can run any zero-delay timers immediately and avoid the
flicker.</p>
<p><a name="timeout" href="#timeout">#</a>
d3.<b>timeout</b>(<i>callback</i>[, <i>delay</i>[, <i>time</i>]]) <a
href="https://github.com/d3/d3-timer/blob/master/src/timeout.js"
title="Source">&lt;&gt;</a></p>
<p>Like <a href="#timer">timer</a>, except the timer automatically <a
href="#timer_stop">stops</a> on its first callback. A suitable
replacement for <a
href="https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout">setTimeout</a>
that is guaranteed to not run in the background. The <em>callback</em>
is passed the elapsed time.</p>
<p><a name="interval" href="#interval">#</a>
d3.<b>interval</b>(<i>callback</i>[, <i>delay</i>[, <i>time</i>]]) <a
href="https://github.com/d3/d3-timer/blob/master/src/interval.js"
title="Source">&lt;&gt;</a></p>
<p>Like <a href="#timer">timer</a>, except the <em>callback</em> is
invoked only every <em>delay</em> milliseconds; if <em>delay</em> is not
specified, this is equivalent to <a href="#timer">timer</a>. A suitable
replacement for <a
href="https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setInterval">setInterval</a>
that is guaranteed to not run in the background. The <em>callback</em>
is passed the elapsed time.</p>
</body>
</html>
