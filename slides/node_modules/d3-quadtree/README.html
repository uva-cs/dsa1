<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title># d3-quadtree</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="../../../markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="d3-quadtree">d3-quadtree</h1>
<p>A <a href="https://en.wikipedia.org/wiki/Quadtree">quadtree</a>
recursively partitions two-dimensional space into squares, dividing each
square into four equally-sized squares. Each distinct point exists in a
unique leaf <a href="#nodes">node</a>; coincident points are represented
by a linked list. Quadtrees can accelerate various spatial operations,
such as the <a
href="https://en.wikipedia.org/wiki/Barnes–Hut_simulation">Barnes–Hut
approximation</a> for computing many-body forces, collision detection,
and searching for nearby points.</p>
<p><a href="http://bl.ocks.org/mbostock/9078690"><img src="http://bl.ocks.org/mbostock/raw/9078690/thumbnail.png" width="202"></a>
<a href="http://bl.ocks.org/mbostock/4343214"><img src="http://bl.ocks.org/mbostock/raw/4343214/thumbnail.png" width="202"></a></p>
<h2 id="installing">Installing</h2>
<p>If you use NPM, <code>npm install d3-quadtree</code>. Otherwise,
download the <a
href="https://github.com/d3/d3-quadtree/releases/latest">latest
release</a>. You can also load directly from <a
href="https://d3js.org">d3js.org</a>, either as a <a
href="https://d3js.org/d3-quadtree.v1.min.js">standalone library</a> or
as part of <a href="https://github.com/d3/d3">D3 4.0</a>. AMD, CommonJS,
and vanilla environments are supported. In vanilla, a <code>d3</code>
global is exported:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script</span> <span class="er">src</span><span class="ot">=</span><span class="st">&quot;https://d3js.org/d3-quadtree.v1.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> quadtree <span class="op">=</span> d3<span class="op">.</span><span class="fu">quadtree</span>()<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/script&gt;</span></span></code></pre></div>
<p><a href="https://tonicdev.com/npm/d3-quadtree">Try d3-quadtree in
your browser.</a></p>
<h2 id="api-reference">API Reference</h2>
<p><a name="quadtree" href="#quadtree">#</a>
d3.<b>quadtree</b>([<i>data</i>[, <i>x</i>, <i>y</i>]]) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/quadtree.js#L14"
title="Source">&lt;&gt;</a></p>
<p>Creates a new, empty quadtree with an empty <a
href="#quadtree_extent">extent</a> and the default <a
href="#quadtree_x"><em>x</em>-</a> and <a
href="#quadtree_y"><em>y</em>-</a>accessors. If <em>data</em> is
specified, <a href="#quadtree_addAll">adds</a> the specified array of
data to the quadtree. This is equivalent to:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> tree <span class="op">=</span> d3<span class="op">.</span><span class="fu">quadtree</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">addAll</span>(data)<span class="op">;</span></span></code></pre></div>
<p>If <em>x</em> and <em>y</em> are also specified, sets the <a
href="#quadtree_x"><em>x</em>-</a> and <a
href="#quadtree_y"><em>y</em>-</a> accessors to the specified functions
before adding the specified array of data to the quadtree, equivalent
to:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> tree <span class="op">=</span> d3<span class="op">.</span><span class="fu">quadtree</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">x</span>(x)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">y</span>(y)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">addAll</span>(data)<span class="op">;</span></span></code></pre></div>
<p><a name="quadtree_x" href="#quadtree_x">#</a>
<i>quadtree</i>.<b>x</b>([<i>x</i>]) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/x.js"
title="Source">&lt;&gt;</a></p>
<p>If <em>x</em> is specified, sets the current <em>x</em>-coordinate
accessor and returns the quadtree. If <em>x</em> is not specified,
returns the current <em>x</em>-accessor, which defaults to:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">x</span>(d) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <em>x</em>-acccessor is used to derive the <em>x</em>-coordinate
of data when <a href="#quadtree_add">adding</a> to and <a
href="#quadtree_remove">removing</a> from the tree. It is also used when
<a href="#quadtree_find">finding</a> to re-access the coordinates of
data previously added to the tree; therefore, the <em>x</em>- and
<em>y</em>-accessors must be consistent, returning the same value given
the same input.</p>
<p><a name="quadtree_y" href="#quadtree_y">#</a>
<i>quadtree</i>.<b>y</b>([<i>y</i>]) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/y.js"
title="Source">&lt;&gt;</a></p>
<p>If <em>y</em> is specified, sets the current <em>y</em>-coordinate
accessor and returns the quadtree. If <em>y</em> is not specified,
returns the current <em>y</em>-accessor, which defaults to:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">y</span>(d) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <em>y</em>-acccessor is used to derive the <em>y</em>-coordinate
of data when <a href="#quadtree_add">adding</a> to and <a
href="#quadtree_remove">removing</a> from the tree. It is also used when
<a href="#quadtree_find">finding</a> to re-access the coordinates of
data previously added to the tree; therefore, the <em>x</em>- and
<em>y</em>-accessors must be consistent, returning the same value given
the same input.</p>
<p><a name="quadtree_extent" href="#quadtree_extent">#</a>
<i>quadtree</i>.<b>extent</b>([<em>extent</em>]) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/extent.js"
title="Source">&lt;&gt;</a></p>
<p>If <em>extent</em> is specified, expands the quadtree to <a
href="#quadtree_cover">cover</a> the specified points [[<em>x0</em>,
<em>y0</em>], [<em>x1</em>, <em>y1</em>]] and returns the quadtree. If
<em>extent</em> is not specified, returns the quadtree’s current extent
[[<em>x0</em>, <em>y0</em>], [<em>x1</em>, <em>y1</em>]], where
<em>x0</em> and <em>y0</em> are the inclusive lower bounds and
<em>x1</em> and <em>y1</em> are the inclusive upper bounds, or undefined
if the quadtree has no extent. The extent may also be expanded by
calling <a href="#quadtree_cover"><em>quadtree</em>.cover</a> or <a
href="#quadtree_add"><em>quadtree</em>.add</a>.</p>
<p><a name="quadtree_cover" href="#quadtree_cover">#</a>
<i>quadtree</i>.<b>cover</b>(<i>x</i>, <i>y</i>) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/cover.js"
title="Source">&lt;&gt;</a></p>
<p>Expands the quadtree to cover the specified point
⟨<em>x</em>,<em>y</em>⟩, and returns the quadtree. If the quadtree’s
extent already covers the specified point, this method does nothing. If
the quadtree has an extent, the extent is repeatedly doubled to cover
the specified point, wrapping the <a href="#quadtree_root">root</a> <a
href="#nodes">node</a> as necessary; if the quadtree is empty, the
extent is initialized to the extent [[⌊<em>x</em>⌋, ⌊<em>y</em>⌋],
[⌈<em>x</em>⌉, ⌈<em>y</em>⌉]]. (Rounding is necessary such that if the
extent is later doubled, the boundaries of existing quadrants do not
change due to floating point error.)</p>
<p><a name="quadtree_add" href="#quadtree_add">#</a>
<i>quadtree</i>.<b>add</b>(<i>datum</i>) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/add.js"
title="Source">&lt;&gt;</a></p>
<p>Adds the specified <em>datum</em> to the quadtree, deriving its
coordinates ⟨<em>x</em>,<em>y</em>⟩ using the current <a
href="#quadtree_x"><em>x</em>-</a> and <a
href="#quadtree_y"><em>y</em>-</a>accessors, and returns the quadtree.
If the new point is outside the current <a
href="#quadtree_extent">extent</a> of the quadtree, the quadtree is
automatically expanded to <a href="#quadtree_cover">cover</a> the new
point.</p>
<p><a name="quadtree_addAll" href="#quadtree_addAll">#</a>
<i>quadtree</i>.<b>addAll</b>(<i>data</i>) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/add.js#L50"
title="Source">&lt;&gt;</a></p>
<p>Adds the specified array of <em>data</em> to the quadtree, deriving
each element’s coordinates ⟨<em>x</em>,<em>y</em>⟩ using the current <a
href="#quadtree_x"><em>x</em>-</a> and <a
href="#quadtree_y"><em>y</em>-</a>accessors, and return this quadtree.
This is approximately equivalent to calling <a
href="#quadtree_add"><em>quadtree</em>.add</a> repeatedly:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> n <span class="op">=</span> data<span class="op">.</span><span class="at">length</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  quadtree<span class="op">.</span><span class="fu">add</span>(data[i])<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>However, this method results in a more compact quadtree because the
extent of the <em>data</em> is computed first before adding the
data.</p>
<p><a name="quadtree_remove" href="#quadtree_remove">#</a>
<i>quadtree</i>.<b>remove</b>(<i>datum</i>) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/remove.js"
title="Source">&lt;&gt;</a></p>
<p>Removes the specified <em>datum</em> to the quadtree, deriving its
coordinates ⟨<em>x</em>,<em>y</em>⟩ using the current <a
href="#quadtree_x"><em>x</em>-</a> and <a
href="#quadtree_y"><em>y</em>-</a>accessors, and returns the quadtree.
If the specified <em>datum</em> does not exist in this quadtree, this
method does nothing.</p>
<p><a name="quadtree_removeAll" href="#quadtree_removeAll">#</a>
<i>quadtree</i>.<b>removeAll</b>(<i>data</i>) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/remove.js#L59"
title="Source">&lt;&gt;</a></p>
<p>…</p>
<p><a name="quadtree_copy" href="#quadtree_copy">#</a>
<i>quadtree</i>.<b>copy</b>()</p>
<p>Returns a copy of the quadtree. All <a href="#nodes">nodes</a> in the
returned quadtree are identical copies of the corresponding node in the
quadtree; however, any data in the quadtree is shared by reference and
not copied.</p>
<p><a name="quadtree_root" href="#quadtree_root">#</a>
<i>quadtree</i>.<b>root</b>() <a
href="https://github.com/d3/d3-quadtree/blob/master/src/root.js"
title="Source">&lt;&gt;</a></p>
<p>Returns the root <a href="#nodes">node</a> of the quadtree.</p>
<p><a name="quadtree_data" href="#quadtree_data">#</a>
<i>quadtree</i>.<b>data</b>() <a
href="https://github.com/d3/d3-quadtree/blob/master/src/data.js"
title="Source">&lt;&gt;</a></p>
<p>Returns an array of all data in the quadtree.</p>
<p><a name="quadtree_size" href="#quadtree_size">#</a>
<i>quadtree</i>.<b>size</b>() <a
href="https://github.com/d3/d3-quadtree/blob/master/src/size.js"
title="Source">&lt;&gt;</a></p>
<p>Returns the total number of data in the quadtree.</p>
<p><a name="quadtree_find" href="#quadtree_find">#</a>
<i>quadtree</i>.<b>find</b>(<i>x</i>, <i>y</i>[, <i>radius</i>]) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/find.js"
title="Source">&lt;&gt;</a></p>
<p>Returns the datum closest to the position ⟨<em>x</em>,<em>y</em>⟩
with the given search <em>radius</em>. If <em>radius</em> is not
specified, it defaults to infinity. If there is no datum within the
search area, returns undefined.</p>
<p><a name="quadtree_visit" href="#quadtree_visit">#</a>
<i>quadtree</i>.<b>visit</b>(<i>callback</i>) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/visit.js"
title="Source">&lt;&gt;</a></p>
<p>Visits each <a href="#nodes">node</a> in the quadtree in pre-order
traversal, invoking the specified <em>callback</em> with arguments
<em>node</em>, <em>x0</em>, <em>y0</em>, <em>x1</em>, <em>y1</em> for
each node, where <em>node</em> is the node being visited, ⟨<em>x0</em>,
<em>y0</em>⟩ are the lower bounds of the node, and ⟨<em>x1</em>,
<em>y1</em>⟩ are the upper bounds, and returns the quadtree. (Assuming
that positive <em>x</em> is right and positive <em>y</em> is down, as is
typically the case in Canvas and SVG, ⟨<em>x0</em>, <em>y0</em>⟩ is the
top-left corner and ⟨<em>x1</em>, <em>y1</em>⟩ is the lower-right
corner; however, the coordinate system is arbitrary, so more formally
<em>x0</em> &lt;= <em>x1</em> and <em>y0</em> &lt;= <em>y1</em>.)</p>
<p>If the <em>callback</em> returns true for a given node, then the
children of that node are not visited; otherwise, all child nodes are
visited. This can be used to quickly visit only parts of the tree, for
example when using the <a
href="https://en.wikipedia.org/wiki/Barnes–Hut_simulation">Barnes–Hut
approximation</a>. Note, however, that child quadrants are always
visited in sibling order: top-left, top-right, bottom-left,
bottom-right. In cases such as <a href="#quadtree_find">search</a>,
visiting siblings in a specific order may be faster.</p>
<p><a name="quadtree_visitAfter" href="#quadtree_visitAfter">#</a>
<i>quadtree</i>.<b>visitAfter</b>(<i>callback</i>) <a
href="https://github.com/d3/d3-quadtree/blob/master/src/visitAfter.js"
title="Source">&lt;&gt;</a></p>
<p>Visits each <a href="#nodes">node</a> in the quadtree in post-order
traversal, invoking the specified <em>callback</em> with arguments
<em>node</em>, <em>x0</em>, <em>y0</em>, <em>x1</em>, <em>y1</em> for
each node, where <em>node</em> is the node being visited, ⟨<em>x0</em>,
<em>y0</em>⟩ are the lower bounds of the node, and ⟨<em>x1</em>,
<em>y1</em>⟩ are the upper bounds, and returns the quadtree. (Assuming
that positive <em>x</em> is right and positive <em>y</em> is down, as is
typically the case in Canvas and SVG, ⟨<em>x0</em>, <em>y0</em>⟩ is the
top-left corner and ⟨<em>x1</em>, <em>y1</em>⟩ is the lower-right
corner; however, the coordinate system is arbitrary, so more formally
<em>x0</em> &lt;= <em>x1</em> and <em>y0</em> &lt;= <em>y1</em>.)
Returns <em>root</em>.</p>
<h3 id="nodes">Nodes</h3>
<p>Internal nodes of the quadtree are represented as four-element arrays
in left-to-right, top-to-bottom order:</p>
<ul>
<li><code>0</code> - the top-left quadrant, if any.</li>
<li><code>1</code> - the top-right quadrant, if any.</li>
<li><code>2</code> - the bottom-left quadrant, if any.</li>
<li><code>3</code> - the bottom-right quadrant, if any.</li>
</ul>
<p>A child quadrant may be undefined if it is empty.</p>
<p>Leaf nodes are represented as objects with the following
properties:</p>
<ul>
<li><code>data</code> - the data associated with this point, as passed
to <a href="#quadtree_add"><em>quadtree</em>.add</a>.</li>
<li><code>next</code> - the next datum in this leaf, if any.</li>
</ul>
<p>The <code>length</code> property may be used to distinguish leaf
nodes from internal nodes: it is undefined for leaf nodes, and 4 for
internal nodes. For example, to iterate over all data in a leaf
node:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>node<span class="op">.</span><span class="at">length</span>) <span class="cf">do</span> <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(node<span class="op">.</span><span class="at">data</span>)<span class="op">;</span> <span class="cf">while</span> (node <span class="op">=</span> node<span class="op">.</span><span class="at">next</span>)<span class="op">;</span></span></code></pre></div>
<p>The point’s <em>x</em>- and <em>y</em>-coordinates <strong>must not
be modified</strong> while the point is in the quadtree. To update a
point’s position, <a href="#quadtree_remove">remove</a> the point and
then re-<a href="#quadtree_add">add</a> it to the quadtree at the new
position. Alternatively, you may discard the existing quadtree entirely
and create a new one from scratch; this may be more efficient if many of
the points have moved.</p>
</body>
</html>
