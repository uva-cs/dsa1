<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title># d3-collection</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="../../../markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="d3-collection">d3-collection</h1>
<p>Handy data structures for elements keyed by string.</p>
<h2 id="installing">Installing</h2>
<p>If you use NPM, <code>npm install d3-collection</code>. Otherwise,
download the <a
href="https://github.com/d3/d3-collection/releases/latest">latest
release</a>. You can also load directly from <a
href="https://d3js.org">d3js.org</a>, either as a <a
href="https://d3js.org/d3-collection.v1.min.js">standalone library</a>
or as part of <a href="https://github.com/d3/d3">D3 4.0</a>. AMD,
CommonJS, and vanilla environments are supported. In vanilla, a
<code>d3</code> global is exported:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script</span> <span class="er">src</span><span class="ot">=</span><span class="st">&quot;https://d3js.org/d3-collection.v1.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> map <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>()</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;bar&quot;</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/script&gt;</span></span></code></pre></div>
<p><a href="https://tonicdev.com/npm/d3-collection">Try d3-collection in
your browser.</a></p>
<h2 id="api-reference">API Reference</h2>
<ul>
<li><a href="#objects">Objects</a></li>
<li><a href="#maps">Maps</a></li>
<li><a href="#sets">Sets</a></li>
<li><a href="#nests">Nests</a></li>
</ul>
<h3 id="objects">Objects</h3>
<p>A common data type in JavaScript is the <em>associative array</em>,
or more simply the <em>object</em>, which has a set of named properties.
The standard mechanism for iterating over the keys (or property names)
in an associative array is the <a
href="https://developer.mozilla.org/en/JavaScript/Reference/Statements/for...in">for…in
loop</a>. However, note that the iteration order is undefined. D3
provides several methods for converting associative arrays to standard
arrays with numeric indexes.</p>
<p>A word of caution: it is tempting to use plain objects as maps, but
this causes <a
href="http://www.devthought.com/2012/01/18/an-object-is-not-a-hash/">unexpected
behavior</a> when built-in property names are used as keys, such as
<code>object["__proto__"] = 42</code> and <code>"hasOwnProperty" in
object</code>. If you cannot guarantee that map keys and set values will
be safe, use <a href="#maps">maps</a> and <a href="#sets">sets</a> (or
their ES6 equivalents) instead of plain objects.</p>
<p><a name="keys" href="#keys">#</a> d3.<b>keys</b>(<i>object</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/keys.js"
title="Source">&lt;&gt;</a></p>
<p>Returns an array containing the property names of the specified
object (an associative array). The order of the returned array is
undefined.</p>
<p><a name="values" href="#values">#</a> d3.<b>values</b>(<i>object</i>)
<a href="https://github.com/d3/d3-collection/blob/master/src/values.js"
title="Source">&lt;&gt;</a></p>
<p>Returns an array containing the property values of the specified
object (an associative array). The order of the returned array is
undefined.</p>
<p><a name="entries" href="#entries">#</a>
d3.<b>entries</b>(<i>object</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/entries.js"
title="Source">&lt;&gt;</a></p>
<p>Returns an array containing the property keys and values of the
specified object (an associative array). Each entry is an object with a
key and value attribute, such as <code>{key: "foo", value: 42}</code>.
The order of the returned array is undefined.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>d3<span class="op">.</span><span class="fu">entries</span>({<span class="dt">foo</span><span class="op">:</span> <span class="dv">42</span><span class="op">,</span> <span class="dt">bar</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span> <span class="co">// [{key: &quot;foo&quot;, value: 42}, {key: &quot;bar&quot;, value: true}]</span></span></code></pre></div>
<h3 id="maps">Maps</h3>
<p>Like <a
href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">ES6
Maps</a>, but with a few differences:</p>
<ul>
<li>Keys are coerced to strings.</li>
<li><a href="#map_each">map.each</a>, not <a
href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/forEach">map.forEach</a>.
(Also, no <em>thisArg</em>.)</li>
<li><a href="#map_remove">map.remove</a>, not <a
href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/delete">map.delete</a>.</li>
<li><a href="#map_entries">map.entries</a> returns an array of {key,
value} objects, not an iterator of [key, value].</li>
<li><a href="#map_size">map.size</a> is a method, not a <a
href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/size">property</a>;
also, there’s <a href="#map_empty">map.empty</a>.</li>
</ul>
<p><a name="map" href="#map">#</a> d3.<b>map</b>([<i>object</i>[,
<i>key</i>]]) <a
href="https://github.com/d3/d3-collection/blob/master/src/map.js"
title="Source">&lt;&gt;</a></p>
<p>Constructs a new map. If <em>object</em> is specified, copies all
enumerable properties from the specified object into this map. The
specified object may also be an array or another map. An optional
<em>key</em> function may be specified to compute the key for each value
in the array. For example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> map <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>([{<span class="dt">name</span><span class="op">:</span> <span class="st">&quot;foo&quot;</span>}<span class="op">,</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">&quot;bar&quot;</span>}]<span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">name</span><span class="op">;</span> })<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;foo&quot;</span>)<span class="op">;</span> <span class="co">// {&quot;name&quot;: &quot;foo&quot;}</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;bar&quot;</span>)<span class="op">;</span> <span class="co">// {&quot;name&quot;: &quot;bar&quot;}</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;baz&quot;</span>)<span class="op">;</span> <span class="co">// undefined</span></span></code></pre></div>
<p>See also <a href="#nests">nests</a>.</p>
<p><a name="map_has" href="#map_has">#</a>
<i>map</i>.<b>has</b>(<i>key</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/map.js#L7"
title="Source">&lt;&gt;</a></p>
<p>Returns true if and only if this map has an entry for the specified
<em>key</em> string. Note: the value may be <code>null</code> or
<code>undefined</code>.</p>
<p><a name="map_get" href="#map_get">#</a>
<i>map</i>.<b>get</b>(<i>key</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/map.js#L10"
title="Source">&lt;&gt;</a></p>
<p>Returns the value for the specified <em>key</em> string. If the map
does not have an entry for the specified <em>key</em>, returns
<code>undefined</code>.</p>
<p><a name="map_set" href="#map_set">#</a>
<i>map</i>.<b>set</b>(<i>key</i>, <i>value</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/map.js#L13"
title="Source">&lt;&gt;</a></p>
<p>Sets the <em>value</em> for the specified <em>key</em> string. If the
map previously had an entry for the same <em>key</em> string, the old
entry is replaced with the new value. Returns the map, allowing
chaining. For example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> map <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;bar&quot;</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;baz&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;foo&quot;</span>)<span class="op">;</span> <span class="co">// 1</span></span></code></pre></div>
<p><a name="map_remove" href="#map_remove">#</a>
<i>map</i>.<b>remove</b>(<i>key</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/map.js#L17"
title="Source">&lt;&gt;</a></p>
<p>If the map has an entry for the specified <em>key</em> string,
removes the entry and returns true. Otherwise, this method does nothing
and returns false.</p>
<p><a name="map_clear" href="#map_clear">#</a> <i>map</i>.<b>clear</b>()
<a href="https://github.com/d3/d3-collection/blob/master/src/map.js#L21"
title="Source">&lt;&gt;</a></p>
<p>Removes all entries from this map.</p>
<p><a name="map_keys" href="#map_keys">#</a> <i>map</i>.<b>keys</b>() <a
href="https://github.com/d3/d3-collection/blob/master/src/map.js#L24"
title="Source">&lt;&gt;</a></p>
<p>Returns an array of string keys for every entry in this map. The
order of the returned keys is arbitrary.</p>
<p><a name="map_values" href="#map_values">#</a>
<i>map</i>.<b>values</b>() <a
href="https://github.com/d3/d3-collection/blob/master/src/map.js#L29"
title="Source">&lt;&gt;</a></p>
<p>Returns an array of values for every entry in this map. The order of
the returned values is arbitrary.</p>
<p><a name="map_entries" href="#map_entries">#</a>
<i>map</i>.<b>entries</b>() <a
href="https://github.com/d3/d3-collection/blob/master/src/map.js#L34"
title="Source">&lt;&gt;</a></p>
<p>Returns an array of key-value objects for each entry in this map. The
order of the returned entries is arbitrary. Each entry’s key is a
string, but the value has arbitrary type.</p>
<p><a name="map_each" href="#map_each">#</a>
<i>map</i>.<b>each</b>(<i>function</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/map.js#L48"
title="Source">&lt;&gt;</a></p>
<p>Calls the specified <em>function</em> for each entry in this map,
passing the entry’s value and key as arguments, followed by the map
itself. Returns undefined. The iteration order is arbitrary.</p>
<p><a name="map_empty" href="#map_empty">#</a> <i>map</i>.<b>empty</b>()
<a href="https://github.com/d3/d3-collection/blob/master/src/map.js#L44"
title="Source">&lt;&gt;</a></p>
<p>Returns true if and only if this map has zero entries.</p>
<p><a name="map_size" href="#map_size">#</a> <i>map</i>.<b>size</b>() <a
href="https://github.com/d3/d3-collection/blob/master/src/map.js#L39"
title="Source">&lt;&gt;</a></p>
<p>Returns the number of entries in this map.</p>
<h3 id="sets">Sets</h3>
<p>Like <a
href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">ES6
Sets</a>, but with a few differences:</p>
<ul>
<li>Values are coerced to strings.</li>
<li><a href="#set_each">set.each</a>, not <a
href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set/forEach">set.forEach</a>.
(Also, no <em>thisArg</em>.)</li>
<li><a href="#set_remove">set.remove</a>, not <a
href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set/delete">set.delete</a>.</li>
<li><a href="#set_size">set.size</a> is a method, not a <a
href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set/size">property</a>;
also, there’s <a href="#set_empty">set.empty</a>.</li>
</ul>
<p><a name="set" href="#set">#</a> d3.<b>set</b>([<i>array</i>[,
<i>accessor</i>]]) <a
href="https://github.com/d3/d3-collection/blob/master/src/set.js"
title="Source">&lt;&gt;</a></p>
<p>Constructs a new set. If <em>array</em> is specified, adds the given
<em>array</em> of string values to the returned set. The specified array
may also be another set. An optional <em>accessor</em> function may be
specified, which is equivalent to calling <em>array.map(accessor)</em>
before constructing the set.</p>
<p><a name="set_has" href="#set_has">#</a>
<i>set</i>.<b>has</b>(<i>value</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/set.js#L9"
title="Source">&lt;&gt;</a></p>
<p>Returns true if and only if this set has an entry for the specified
<em>value</em> string.</p>
<p><a name="set_add" href="#set_add">#</a>
<i>set</i>.<b>add</b>(<i>value</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/set.js#L10"
title="Source">&lt;&gt;</a></p>
<p>Adds the specified <em>value</em> string to this set. Returns the
set, allowing chaining. For example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> set <span class="op">=</span> d3<span class="op">.</span><span class="fu">set</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span>(<span class="st">&quot;foo&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span>(<span class="st">&quot;bar&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span>(<span class="st">&quot;baz&quot;</span>)<span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>set<span class="op">.</span><span class="fu">has</span>(<span class="st">&quot;foo&quot;</span>)<span class="op">;</span> <span class="co">// true</span></span></code></pre></div>
<p><a name="set_remove" href="#set_remove">#</a>
<i>set</i>.<b>remove</b>(<i>value</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/set.js#L15"
title="Source">&lt;&gt;</a></p>
<p>If the set contains the specified <em>value</em> string, removes it
and returns true. Otherwise, this method does nothing and returns
false.</p>
<p><a name="set_clear" href="#set_clear">#</a> <i>set</i>.<b>clear</b>()
<a href="https://github.com/d3/d3-collection/blob/master/src/set.js#L16"
title="Source">&lt;&gt;</a></p>
<p>Removes all values from this set.</p>
<p><a name="set_values" href="#set_values">#</a>
<i>set</i>.<b>values</b>() <a
href="https://github.com/d3/d3-collection/blob/master/src/set.js#L17"
title="Source">&lt;&gt;</a></p>
<p>Returns an array of the string values in this set. The order of the
returned values is arbitrary. Can be used as a convenient way of
computing the unique values for a set of strings. For example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>d3<span class="op">.</span><span class="fu">set</span>([<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="st">&quot;bar&quot;</span><span class="op">,</span> <span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="st">&quot;baz&quot;</span>])<span class="op">.</span><span class="fu">values</span>()<span class="op">;</span> <span class="co">// &quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;</span></span></code></pre></div>
<p><a name="set_each" href="#set_each">#</a>
<i>set</i>.<b>each</b>(<i>function</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/set.js#L20"
title="Source">&lt;&gt;</a></p>
<p>Calls the specified <em>function</em> for each value in this set,
passing the value as the first two arguments (for symmetry with <a
href="#map_each"><em>map</em>.each</a>), followed by the set itself.
Returns undefined. The iteration order is arbitrary.</p>
<p><a name="set_empty" href="#set_empty">#</a> <i>set</i>.<b>empty</b>()
<a href="https://github.com/d3/d3-collection/blob/master/src/set.js#L19"
title="Source">&lt;&gt;</a></p>
<p>Returns true if and only if this set has zero values.</p>
<p><a name="set_size" href="#set_size">#</a> <i>set</i>.<b>size</b>() <a
href="https://github.com/d3/d3-collection/blob/master/src/set.js#L18"
title="Source">&lt;&gt;</a></p>
<p>Returns the number of values in this set.</p>
<h3 id="nests">Nests</h3>
<p>Nesting allows elements in an array to be grouped into a hierarchical
tree structure; think of it like the GROUP BY operator in SQL, except
you can have multiple levels of grouping, and the resulting output is a
tree rather than a flat table. The levels in the tree are specified by
key functions. The leaf nodes of the tree can be sorted by value, while
the internal nodes can be sorted by key. An optional rollup function
will collapse the elements in each leaf node using a summary function.
The nest operator (the object returned by <a href="#nest">nest</a>) is
reusable, and does not retain any references to the data that is
nested.</p>
<p>For example, consider the following tabular data structure of Barley
yields, from various sites in Minnesota during 1931-2:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> yields <span class="op">=</span> [</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">yield</span><span class="op">:</span> <span class="fl">27.00</span><span class="op">,</span> <span class="dt">variety</span><span class="op">:</span> <span class="st">&quot;Manchuria&quot;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1931</span><span class="op">,</span> <span class="dt">site</span><span class="op">:</span> <span class="st">&quot;University Farm&quot;</span>}<span class="op">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">yield</span><span class="op">:</span> <span class="fl">48.87</span><span class="op">,</span> <span class="dt">variety</span><span class="op">:</span> <span class="st">&quot;Manchuria&quot;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1931</span><span class="op">,</span> <span class="dt">site</span><span class="op">:</span> <span class="st">&quot;Waseca&quot;</span>}<span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">yield</span><span class="op">:</span> <span class="fl">27.43</span><span class="op">,</span> <span class="dt">variety</span><span class="op">:</span> <span class="st">&quot;Manchuria&quot;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1931</span><span class="op">,</span> <span class="dt">site</span><span class="op">:</span> <span class="st">&quot;Morris&quot;</span>}<span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div>
<p>To facilitate visualization, it may be useful to nest the elements
first by year, and then by variety, as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> entries <span class="op">=</span> d3<span class="op">.</span><span class="fu">nest</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">key</span>(<span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">year</span><span class="op">;</span> })</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">key</span>(<span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">variety</span><span class="op">;</span> })</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">entries</span>(yields)<span class="op">;</span></span></code></pre></div>
<p>This returns a nested array. Each element of the outer array is a
key-values pair, listing the values for each distinct key:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>[{<span class="dt">key</span><span class="op">:</span> <span class="st">&quot;1931&quot;</span><span class="op">,</span> <span class="dt">values</span><span class="op">:</span> [</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>   {<span class="dt">key</span><span class="op">:</span> <span class="st">&quot;Manchuria&quot;</span><span class="op">,</span> <span class="dt">values</span><span class="op">:</span> [</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>     {<span class="dt">yield</span><span class="op">:</span> <span class="fl">27.00</span><span class="op">,</span> <span class="dt">variety</span><span class="op">:</span> <span class="st">&quot;Manchuria&quot;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1931</span><span class="op">,</span> <span class="dt">site</span><span class="op">:</span> <span class="st">&quot;University Farm&quot;</span>}<span class="op">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>     {<span class="dt">yield</span><span class="op">:</span> <span class="fl">48.87</span><span class="op">,</span> <span class="dt">variety</span><span class="op">:</span> <span class="st">&quot;Manchuria&quot;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1931</span><span class="op">,</span> <span class="dt">site</span><span class="op">:</span> <span class="st">&quot;Waseca&quot;</span>}<span class="op">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>     {<span class="dt">yield</span><span class="op">:</span> <span class="fl">27.43</span><span class="op">,</span> <span class="dt">variety</span><span class="op">:</span> <span class="st">&quot;Manchuria&quot;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1931</span><span class="op">,</span> <span class="dt">site</span><span class="op">:</span> <span class="st">&quot;Morris&quot;</span>}<span class="op">,</span> <span class="op">...</span>]}<span class="op">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>   {<span class="dt">key</span><span class="op">:</span> <span class="st">&quot;Glabron&quot;</span><span class="op">,</span> <span class="dt">values</span><span class="op">:</span> [</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>     {<span class="dt">yield</span><span class="op">:</span> <span class="fl">43.07</span><span class="op">,</span> <span class="dt">variety</span><span class="op">:</span> <span class="st">&quot;Glabron&quot;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1931</span><span class="op">,</span> <span class="dt">site</span><span class="op">:</span> <span class="st">&quot;University Farm&quot;</span>}<span class="op">,</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>     {<span class="dt">yield</span><span class="op">:</span> <span class="fl">55.20</span><span class="op">,</span> <span class="dt">variety</span><span class="op">:</span> <span class="st">&quot;Glabron&quot;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1931</span><span class="op">,</span> <span class="dt">site</span><span class="op">:</span> <span class="st">&quot;Waseca&quot;</span>}<span class="op">,</span> <span class="op">...</span>]}<span class="op">,</span> <span class="op">...</span>]}<span class="op">,</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a> {<span class="dt">key</span><span class="op">:</span> <span class="st">&quot;1932&quot;</span><span class="op">,</span> <span class="dt">values</span><span class="op">:</span> <span class="op">...</span>}]</span></code></pre></div>
<p>The nested form allows easy iteration and generation of hierarchical
structures in SVG or HTML.</p>
<p>For a longer introduction to nesting, see:</p>
<ul>
<li>Phoebe Bright’s <a
href="http://bl.ocks.org/phoebebright/raw/3176159/">D3 Nest Tutorial and
examples</a></li>
<li>Shan Carter’s <a
href="http://bl.ocks.org/shancarter/raw/4748131/">Mister Nester</a></li>
</ul>
<p><a name="nest" href="#nest">#</a> d3.<b>nest</b>() <a
href="https://github.com/d3/d3-collection/blob/master/src/nest.js"
title="Source">&lt;&gt;</a></p>
<p>Creates a new nest operator. The set of keys is initially empty.</p>
<p><a name="nest_key" href="#nest_key">#</a>
<i>nest</i>.<b>key</b>(<i>key</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/nest.js#L4"
title="Source">&lt;&gt;</a></p>
<p>Registers a new <em>key</em> function. The <em>key</em> function will
be invoked for each element in the input array and must return a string
identifier to assign the element to its group. Most often, the function
is a simple accessor, such as the year and variety accessors above.
(Keys functions are <em>not</em> passed the input array index.) Each
time a key is registered, it is pushed onto the end of the internal
array of keys, and the nest operator applies an additional level of
nesting.</p>
<p><a name="nest_sortKeys" href="#nest_sortKeys">#</a>
<i>nest</i>.<b>sortKeys</b>(<i>comparator</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/nest.js#L5"
title="Source">&lt;&gt;</a></p>
<p>Sorts key values for the <a href="#nest_key">current key</a> using
the specified <em>comparator</em> function, such as <a
href="https://github.com/d3/d3-array#ascending">d3.ascending</a> or <a
href="https://github.com/d3/d3-array#descending">d3.descending</a>. If
no comparator is specified for the current key, the order in which keys
will be returned is undefined. For example, to sort years in ascending
order and varieties in descending order:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> entries <span class="op">=</span> d3<span class="op">.</span><span class="fu">nest</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">key</span>(<span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">year</span><span class="op">;</span> })<span class="op">.</span><span class="fu">sortKeys</span>(d3<span class="op">.</span><span class="at">ascending</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">key</span>(<span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">variety</span><span class="op">;</span> })<span class="op">.</span><span class="fu">sortKeys</span>(d3<span class="op">.</span><span class="at">descending</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">entries</span>(yields)<span class="op">;</span></span></code></pre></div>
<p>Note that this only affects the result of <a
href="#nest_entries"><em>nest</em>.entries</a>; the order of keys
returned by <a href="#nest_map"><em>nest</em>.map</a> and <a
href="#nest_object"><em>nest</em>.object</a> is always undefined,
regardless of comparator.</p>
<p><a name="nest_sortValues" href="#nest_sortValues">#</a>
<i>nest</i>.<b>sortValues</b>(<i>comparator</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/nest.js#L6"
title="Source">&lt;&gt;</a></p>
<p>Sorts leaf elements using the specified <em>comparator</em> function,
such as <a
href="https://github.com/d3/d3-array#ascending">d3.ascending</a> or <a
href="https://github.com/d3/d3-array#descending">d3.descending</a>. This
is roughly equivalent to sorting the input array before applying the
nest operator; however it is typically more efficient as the size of
each group is smaller. If no value comparator is specified, elements
will be returned in the order they appeared in the input array. This
applies to <a href="#nest_map"><em>nest</em>.map</a>, <a
href="#nest_entries"><em>nest</em>.entries</a> and <a
href="#nest_object"><em>nest</em>.object</a>.</p>
<p><a name="nest_rollup" href="#nest_rollup">#</a>
<i>nest</i>.<b>rollup</b>(<i>function</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/nest.js#L7"
title="Source">&lt;&gt;</a></p>
<p>Specifies a rollup <em>function</em> to be applied on each group of
leaf elements. The return value of the rollup function will replace the
array of leaf values in either the associative array returned by <a
href="#nest_map"><em>nest</em>.map</a> or <a
href="#nest_object"><em>nest</em>.object</a>; for <a
href="#nest_entries"><em>nest</em>.entries</a>, it replaces the leaf
<em>entry</em>.values with <em>entry</em>.value. If a <a
href="#nest_sortValues">leaf comparator</a> is specified, the leaf
elements are sorted prior to invoking the rollup function.</p>
<p><a name="nest_map" href="#nest_map">#</a>
<i>nest</i>.<b>map</b>(<i>array</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/nest.js#L50"
title="Source">&lt;&gt;</a></p>
<p>Applies the nest operator to the specified <em>array</em>, returning
a nested <a href="#map">map</a>. Each entry in the returned map
corresponds to a distinct key value returned by the first key function.
The entry value depends on the number of registered key functions: if
there is an additional key, the value is another map; otherwise, the
value is the array of elements filtered from the input <em>array</em>
that have the given key value. If no keys are defined, returns the input
<em>array</em>.</p>
<p><a name="nest_object" href="#nest_object">#</a>
<i>nest</i>.<b>object</b>(<i>array</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/nest.js#L49"
title="Source">&lt;&gt;</a></p>
<p>Applies the nest operator to the specified <em>array</em>, returning
a nested object. Each entry in the returned associative array
corresponds to a distinct key value returned by the first key function.
The entry value depends on the number of registered key functions: if
there is an additional key, the value is another associative array;
otherwise, the value is the array of elements filtered from the input
<em>array</em> that have the given key value.</p>
<p>Note: this method is unsafe if any of the keys conflict with built-in
JavaScript properties, such as <code>__proto__</code>. If you cannot
guarantee that the keys will be safe, you should use <a
href="#nest_map">nest.map</a> instead.</p>
<p><a name="nest_entries" href="#nest_entries">#</a>
<i>nest</i>.<b>entries</b>(<i>array</i>) <a
href="https://github.com/d3/d3-collection/blob/master/src/nest.js#L51"
title="Source">&lt;&gt;</a></p>
<p>Applies the nest operator to the specified <em>array</em>, returning
an array of key-values entries. Conceptually, this is similar to
applying <a href="#map_entries"><em>map</em>.entries</a> to the
associative array returned by <a href="#nest_map"><em>nest</em>.map</a>,
but it applies to every level of the hierarchy rather than just the
first (outermost) level. Each entry in the returned array corresponds to
a distinct key value returned by the first key function. The entry value
depends on the number of registered key functions: if there is an
additional key, the value is another nested array of entries; otherwise,
the value is the array of elements filtered from the input
<em>array</em> that have the given key value.</p>
</body>
</html>
